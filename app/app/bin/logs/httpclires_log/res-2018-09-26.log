[2018-09-26T22:47:40.049] [INFO] httpclires - [login][POST][200]: { code: 200,
  msg: null,
  data: 'eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lJeU5EYzFPRFl5WkMwM09HUTFMVFJrTldRdE9XWXdOaTFoT1RabU5qa3pZMlk1TTJRaUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNekkyTTMwLkZQYzJEbk12UWtJb01qNUVlREpBdnJNQUlHbWpHTk5odndvZThrZlRHWFE1YzMyYXdQbmVRTVlWR3BqbWFpdTlXZVdXOXdCbjIxV0ZTRTBqVkxzZXFaMnhEWnpmdTdWVDVBeHpHbmxBbFItT3hkLUJzc185bU9jX3owZTJyOXQybE5KTmtKeXJQRV9GSC1qSDJ3LUhvb2JfakxxUEdZNnFRQmpBcFd1UVlyayIsIm9yZ0lkIjoiIn0=' }
[2018-09-26T22:47:43.630] [INFO] httpclires - [login][POST][200]: { code: 200,
  msg: null,
  data: 'eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lJM04yUXdOak5rWmkweU5qVXlMVFJqTVRZdFlqbGlNaTFpT0RCbVpEWXdZelEwTm1FaUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNekkyTjMwLmJBS0lHM3lWOEFsM25kSEU5RW9RVUk3eUxxaldqWDB2TUxFaDFSWUJnZXJMVFBlUGRZTDNQLUEzZDZURXk3R3hDTUkwbXBacWdWMXlxeEpfU2h0UTNJdkFFMjR1Z19EMkM1T0FRNmdMUFd3Y2daQjZpNmcwOTRaV0ZSOWlfbUdKWXdHR0xzX3E2bGRLY2pmR0N1MVVtblZkS3pxUndidFE0UXBkNTNSYWlUVSIsIm9yZ0lkIjoiIn0=' }
[2018-09-26T22:48:47.180] [INFO] httpclires - [login][POST][200]: { code: 200,
  msg: null,
  data: 'eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lKa1ltRXhZekF3WWkwelpUZGlMVFF5TVRndE9UUm1PQzB6WWpFMk1qaG1ZVGMxTkRZaUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNek16TUgwLkZjeC14VEdQRy1qbm9VdDRQWEpwUHVwYzg3Sm8wOFJiRFZmdUEtS05kZndKajR3LVZmbWFVajVBaFA0ZnhXeG5wd1lsYjNWSXZIY2ZIRWVFUW1OVGZ1NndGT1pCcnRTNWs0aGtDWHJmTktFV0xMZ2lVU0VNU0lRTk8wN2IwYUZRSXBHWWRzSWlKbERCR2tXLUJSSzdxblNidFVVZVktV1RuN0dSS0IwSlZjRSIsIm9yZ0lkIjoiIn0=' }
[2018-09-26T22:48:50.669] [INFO] httpclires - [login][POST][200]: { code: 200,
  msg: null,
  data: 'eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lJNFpEazVNekF5TVMwek9UZGtMVFE0WVdVdFlXVTROQzB3TW1GaFl6QTJPRFl5TlRRaUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNek16TkgwLkdRc1RmWlVjRW5Qd0tJRnlKdTdMd19RNXk0MjlLemcxQ1lMTmFPNjJSd2otNUhuS1BBcWdLZmFQVWY1T29xSF9yY2NfRnoya0FKVGVabEhUSWhLVGJjYmVUNktWNHF4eUQxdE5vVXRBN2FHcXI4amxwZmd0NXA3T3duYWVqT2RLbFRHQ2tnRVdMX00tLTRLNXpGaTlCWHlRQmxHVnpfS09JVWxtS0RUblNXNCIsIm9yZ0lkIjoiIn0=' }
[2018-09-26T22:49:43.579] [INFO] httpclires - [login][POST][200]: { code: 200,
  msg: null,
  data: 'eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lJNU56Qm1aalZsWXkweFlqSTFMVFJtTmpVdE9HTmpZaTAwTURjek5HSmxPVEZqWlRraUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNek00TjMwLlFpSWdlcW9XRkVKR1ZES3BqZFlKY1dIN1E2TFZUMDlkekd4Umdlb3dUbTU3NHlkUG5LUGhNWjNSOXl2ZEhXczdvR2xtRl9TZVdmQlZvcE5qRG1xSHNWVmdXejVlTTQzLXV4SDdaZzZJa1MzQ1VZOTJIQUxWTFVwNkJraWJ1UzUtZkEyYlNXTEh4eUctNTJhV0tLSktDT2dEenprS1NVR0ZPZjJ6M2JuT2RzTSIsIm9yZ0lkIjoiIn0=' }
[2018-09-26T22:51:07.377] [INFO] httpclires - [login][POST][200]: { code: 200,
  msg: null,
  data: 'eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lJek1HUmlNRGsyWXkxbE9HTXdMVFJpTVRJdE9HSmhOeTAzT1RrNFpUVXdaVEZoTUdJaUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNelEzTVgwLkxKQlZ4dGk5ZnR0d2h3T0tETFVlQlVZOFNhaGJYWC1NUVVuRjZNYUVJaUtXYVBUeklGbDYxOUNoT3dVX2ZNYk9BSWhpSXRrVWlQakNEb2Z3UHBZZGN5TEVtTTdzZ2QyV1JRbS1mMTJvR09JZTQydDE5MmdLelJYdmhPX3FwU3o0VjNscGhDVW9MX3E0MGZMZlBVRUpBX2MyUzlhLXpCNDd5anlPQXotcGVVUSIsIm9yZ0lkIjoiIn0=' }
[2018-09-26T22:51:12.064] [INFO] httpclires - [login][POST][200]: { code: 200,
  msg: null,
  data: 'eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lJME5UUTBZalZrTWkwMk1HRmxMVFEyWm1VdE9EZ3pZeTFqTTJWa1pURmhZakV6WWpjaUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNelEzTlgwLklHYnNyM0RmMnQ1NFU5N0Z6UklIZ3lqNEpZSERYdlNHMjFzNHBWV2YzMW1MaWxlYUxiZnRuWUNzdExmdGdURlhxNkZYLXYxSVo1VUh0aEtCQ2hENjBVNi1xODZSQUJsaDFtUEM1eFJPTlVPZlJtQlloYlNuYTdlVFQ0WThPcUtiYUtCUWY3ck44cngwSHJMNUM2M2d6RWhTVHpFRW1LT01lTzJEZzI0OVVTdyIsIm9yZ0lkIjoiIn0=' }
[2018-09-26T22:51:12.766] [INFO] httpclires - [saleDelivery/QueryExecuting?token=eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lJME5UUTBZalZrTWkwMk1HRmxMVFEyWm1VdE9EZ3pZeTFqTTJWa1pURmhZakV6WWpjaUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNelEzTlgwLklHYnNyM0RmMnQ1NFU5N0Z6UklIZ3lqNEpZSERYdlNHMjFzNHBWV2YzMW1MaWxlYUxiZnRuWUNzdExmdGdURlhxNkZYLXYxSVo1VUh0aEtCQ2hENjBVNi1xODZSQUJsaDFtUEM1eFJPTlVPZlJtQlloYlNuYTdlVFQ0WThPcUtiYUtCUWY3ck44cngwSHJMNUM2M2d6RWhTVHpFRW1LT01lTzJEZzI0OVVTdyIsIm9yZ0lkIjoiIn0=][POST][200]: { code: 200,
  msg: null,
  data: 
   { Rows: [ [Object], [Object], [Object], [Object], [Object], [Object] ] } }
[2018-09-26T22:51:32.011] [INFO] httpclires - [login][POST][200]: { code: 200,
  msg: null,
  data: 'eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lJek4yVXpNMkU0WXkweE5XTmtMVFF3WTJRdFltVmlaaTFoTVRjNU5HRTFPV1l5WXpBaUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNelE1TlgwLmZjU1ZxV2trVlhqMzZYZTRoaG9WcHRlLW5yNVRWLVdWXzFUNVRRSGZyLTFqQnhtQlJBSXhHSEg3dG9fS0ZZQlRDbm81anZsOWZXWnVmZlZnRlAtemQ0T3E5NEZvd3NWaDFtenQ3N1lsOHRxT1pzV0thclBIY0tzM09lRDBFSEZ4cFRlOE1LaHlVYzlRMHJfRE5OTnJqNUkxZTBQYXBEM1dWbUVUSkItX01sZyIsIm9yZ0lkIjoiIn0=' }
[2018-09-26T22:51:32.697] [INFO] httpclires - [saleDelivery/QueryExecuting?token=eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lJek4yVXpNMkU0WXkweE5XTmtMVFF3WTJRdFltVmlaaTFoTVRjNU5HRTFPV1l5WXpBaUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNelE1TlgwLmZjU1ZxV2trVlhqMzZYZTRoaG9WcHRlLW5yNVRWLVdWXzFUNVRRSGZyLTFqQnhtQlJBSXhHSEg3dG9fS0ZZQlRDbm81anZsOWZXWnVmZlZnRlAtemQ0T3E5NEZvd3NWaDFtenQ3N1lsOHRxT1pzV0thclBIY0tzM09lRDBFSEZ4cFRlOE1LaHlVYzlRMHJfRE5OTnJqNUkxZTBQYXBEM1dWbUVUSkItX01sZyIsIm9yZ0lkIjoiIn0=][POST][200]: { code: 200,
  msg: null,
  data: 
   { code: 'EXERROR0001',
     message: '245 数据库错误, 请重试!\r\n\r\n在将 nvarchar 值 \'??\' 转换成数据类型 int 时失败。',
     data: 
      { Code: 'EXERROR0001',
        StatusCode: 400,
        sqlstring: ' select  \r\n                --单据表头信息\r\n                SaleDelivery.voucherdate as voucherdate, --单据日期\r\n                SaleDelivery.Code as saleDeliveryCode, --销货单号\r\n                SaleDelivery.externalCode as externalCode, --外部系统编号\r\n               \r\n                SaleDelivery_BusinessType.name as busiTypeName, --业务类型\r\n                SaleDelivery_IsSaleOut.Name as isSaleOut, --出库状态\r\n                SaleDelivery_IsCancel.Name as isCancel, --结算状态\r\n                SaleDelivery.saleInvoiceNo as saleInvoiceNo, --发票号\r\n                Currency.name as CurrencyName, --币种名称\r\n\r\n                SaleDelivery_Customer.Code as partnerCode, --客户编码\r\n                SaleDelivery_Customer.name as partnerName, --客户名称\r\n                SettleCustomer.Code as SettleCustomerCode, --结算客户编码\r\n                SettleCustomer.Name as SettleCustomer, --结算客户名称\r\n                SaleDelivery.deliveryDate as deliveryDate,  --交货日期\r\n                ReciveType.Name as ReciveTypeName, --收款方式\r\n                SaleDelivery.recivingMaturity as recivingMaturity,--收款到期日\r\n                SaleDelivery.address as address, --送货地址\r\n                SaleDelivery.linkMan as linkMan, --联系人\r\n                SaleDelivery.Memo as Memo, --备注\r\n            \r\n \r\n                --单据表体信息\r\n                Warehouse.code as warehouseCode, --仓库编码\r\n                Warehouse.name as warehouseName, --仓库名称\r\n                SaleDeliveryDetailDTO.InventoryBarCode as InventoryBarCode, --条形码\r\n\r\n                Inventory.code as inventoryCode,   --存货编码\r\n                Inventory.name as inventoryName, --存货名称\r\n                Inventory.specification as specification, --规格型号\r\n                Brand.Name as BrandName, --品牌\r\n                SaleDeliveryDetailDTO.freeItem0 as freeItem0, --自由项1\r\n                SaleDeliveryDetailDTO.freeItem1 as freeItem1, --自由项2\r\n                SaleDeliveryDetailDTO.freeItem2 as freeItem2, --自由项3\r\n                SaleDeliveryDetailDTO.freeItem3 as freeItem3, --自由项4\r\n                SaleDeliveryDetailDTO.freeItem4 as freeItem4, --自由项5\r\n                SaleDeliveryDetailDTO.freeItem5 as freeItem5, --自由项6\r\n                SaleDeliveryDetailDTO.freeItem6 as freeItem6, --自由项7\r\n                SaleDeliveryDetailDTO.freeItem7 as freeItem7, --自由项8\r\n                SaleDeliveryDetailDTO.freeItem8 as freeItem8, --自由项9\r\n                SaleDeliveryDetailDTO.freeItem9 as freeItem9, --自由项10\r\n\r\n                Unit.name as unitName, --销售单位\r\n                SaleDeliveryDetailDTO.Batch as Batch, --批号\r\n                SaleDeliveryDetailDTO.ProductionDate as ProductionDate, --生产日期\r\n                SaleDeliveryDetailDTO.ExpiryDate as ExpiryDate, --失效日期\r\n            \r\n\r\n                SaleDeliveryDetailDTO.quantity as quantity, --数量（销售单位）\r\n                SaleDeliveryDetailDTO.origTaxPrice as origTaxPrice, --含税单价\r\n                SaleDeliveryDetailDTO.origTaxAmount as origTaxAmount, --含税金额  { rDRecordQuantity}  as rDRecordQuantity, --累计出库数量\r\n   ArapSettleAmount.origSettleAmount  as detailOrigSettleAmount, --累计结算金额\r\n  SaleInvoiceQuantity.quantity  as saleInvoiceQuantity, --累计开票数量（销售单位）\r\n  SaleInvoiceTaxAmount.origTaxAmount  as saleInvoiceOrigAmount --累计开票金额\r\n from  \r\n                SA_SaleDelivery_b as SaleDeliveryDetailDTO\r\n                Inner join SA_SaleDelivery as SaleDelivery on SaleDeliveryDetailDTO.idSaleDeliveryDTO=SaleDelivery.id and ( N\'All\'= N\'All\' or ( N\'All\'= N\'TheSame\' and SaleDelivery.idcustomer = SaleDelivery.idsettleCustomer) or ( N\'All\'= N\'InDifferent\' and SaleDelivery.idcustomer <> SaleDelivery.idsettleCustomer))\r\n                left join  AA_BusiType as SaleDelivery_BusinessType on SaleDelivery.idbusinesstype=SaleDelivery_BusinessType.id\r\n                left join  eap_EnumItem as SaleDelivery_IsSaleOut on SaleDelivery_IsSaleOut.id=SaleDelivery.isSaleOut\r\n                left join  eap_EnumItem as SaleDelivery_IsCancel on SaleDelivery_IsCancel.id=SaleDelivery.isCancel\r\n                left join  eap_EnumItem  as ReciveType on SaleDelivery.reciveType=ReciveType.id\r\n                left join  AA_Partner as SaleDelivery_Customer on SaleDelivery.idcustomer=SaleDelivery_Customer.id\r\n                left join AA_Currency as Currency on SaleDelivery.idcurrency = Currency.id\r\n                left join AA_Warehouse as Warehouse on SaleDeliveryDetailDTO.idwarehouse=Warehouse.id\r\n                left join AA_Partner  as SettleCustomer on SaleDelivery.idsettleCustomer=SettleCustomer.id\r\n                Inner join AA_Inventory as Inventory on SaleDeliveryDetailDTO.idinventory=Inventory.id \r\n                left join  eap_EnumItem  as Brand on Inventory.productInfo=Brand.id\r\n                left join AA_Unit as Unit on SaleDeliveryDetailDTO.idunit=Unit.id\r\n                \r\n       \r\n              \r\n left join(select \r\n                                    sum(SA_SaleInvoiceSourceRelation.quantity) quantity,\r\n                                    sum(Round((case BaseUnit.changetype1 \r\n               when  N\'24\' then\r\n                    (case ReportSubunitPrice.idunit when SA_SaleInvoiceSourceRelation.idbaseunit then SA_SaleInvoiceSourceRelation.basequantity else (CAST(SA_SaleInvoiceSourceRelation.basequantity AS NUMERIC(20,7)))/ReportSubunitPrice.rateofexchange end)\r\n               when  N\'152\' then\r\n                    (case ReportSubunitPrice.idunit when SA_SaleInvoiceSourceRelation.idbaseunit then SA_SaleInvoiceSourceRelation.basequantity else SA_SaleInvoiceSourceRelation.subquantity end)\r\n               end),2, 0)) subquantity,\r\n                                    sum(SA_SaleInvoiceSourceRelation.basequantity) basequantity,\t\t              \r\n                                    SA_SaleInvoiceSourceRelation.sourceVoucherDetailId \r\n                                    from SA_SaleInvoiceSourceRelation,SA_SaleInvoice,sa_saleinvoice_b \r\n                                     --app接口没有辅单位取值条件，sqlContext赋值为null表示取默认值\r\n                                    left join V_AA_Inventory as Inventory on sa_saleinvoice_b.idinventory=Inventory.id\r\n                          left join AA_Unit as BaseUnit on sa_saleinvoice_b.idbaseunit=BaseUnit.id \r\n                          left join AA_InventoryUnitPrice as ReportSubunitPrice on ReportSubunitPrice.idunit=inventory.idUnitBySale  and inventory.id=ReportSubunitPrice.Idinventory\r\n                                    where \r\n                                    SA_SaleInvoiceSourceRelation.voucherid=SA_SaleInvoice.id \r\n                                    and SA_SaleInvoiceSourceRelation.idsaleinvoicedetaildto=sa_saleinvoice_b.id \r\n                                    and sa_saleinvoice_b.sourceVoucherDetailId=SA_SaleInvoiceSourceRelation.sourceVoucherDetailId \r\n                                    and ((0=0 and SA_SaleInvoice.voucherState<> N\'181\') or (0=1))\r\n                                    group by SA_SaleInvoiceSourceRelation.sourceVoucherDetailId)\r\n\t                                as \tSaleInvoiceQuantity on    SaleInvoiceQuantity.sourceVoucherDetailId=SaleDeliveryDetailDTO.id \r\n LEFT JOIN ( select \r\n                                                                 SUM(xxx.origCurrentAmount) origsettleamount,\r\n                                                                 SUM(xxx.currentAmount) settleamount,\r\n                                                                 xxx.voucherDetailID\r\n                                                        from (\r\n                                                                select  SUM(Isnull(arap_b.origCurrentAmount,0)) origCurrentAmount,\r\n                                                                        SUM(Isnull(arap_b.currentAmount,0)) currentAmount,\r\n                                                                        arap_b.voucherDetailID\r\n                                                                from ARAP_ReceivePayment_b arap_b\r\n                                                                left join ARAP_ReceivePayment arap on arap_b.idArapReceivePaymentDTO=arap.id\r\n                                                                where arap.voucherState= N\'189\'\r\n                                                                group by arap_b.voucherDetailID\r\n                                                                union all\r\n                                                                select  SUM(Isnull(arsb_b.origCurrentAmount,0)) origCurrentAmount,\r\n                                                                        SUM(Isnull(arsb_b.currentAmount,0)) currentAmount,\r\n                                                                        arsb_b.voucherDetailID\r\n                                                                from ARAP_StrikeBalance_SecondDetail arsb_b\r\n                                                                left join ARAP_StrikeBalance arsb on arsb_b.idArapStrikeBalanceDTO=arsb.id\r\n                                                                where arsb.voucherState= N\'189\' and  arsb.idfirstpartner =arsb.idsecondpartner \r\n                                                                group by arsb_b.voucherDetailID\r\n                                                                 union all\r\n                                                                --应收冲应收 \r\n                                                                select SUM(ISNULL(firstdetail.origCurrentAmount,0)) origcurrentamount,\r\n\t\t\t\t\t\t\t\t\t                            SUM(ISNULL(firstdetail.currentAmount,0)) currentamount,\r\n\t\t\t\t\t\t\t\t\t                            firstdetail.voucherDetailID\r\n                                                                from arap_strikebalance_firstdetail firstdetail\r\n\t\t\t\t\t\t\t\t\t\t                        left join ARAP_StrikeBalance arsb\r\n\t\t\t\t\t\t\t\t\t\t                        on\tfirstdetail.idArapStrikeBalanceDTO=arsb.id\r\n\t\t\t\t\t\t\t\t\t\t                        where arsb.voucherState= N\'189\'\r\n                                                                 and  (arsb.idbusitype <>  N\'12\' or (arsb.idbusitype =  N\'12\' and arsb.idfirstpartner =arsb.idsecondpartner )) \r\n\t\t\t\t\t\t\t\t                                group by firstdetail.voucherDetailID\r\n                                                        ) xxx\r\n                                                        group by xxx.voucherDetailID\r\n\t\t\t\t                                    ) arapsettleamount ON arapsettleamount.voucherDetailID = SaleDeliveryDetailDTO.id   \r\n                                       \r\n                           left join (select distinct\r\n                                        max(cast( RDRecordSR.idunit as varchar(50)))idunit,\r\n                                        max(RDRecord.code) code,\r\n                                        max(RDRecord.voucherdate) voucherdate,\r\n                                        sum(isnull(Round((case BaseUnit.changetype1 \r\n               when  N\'24\' then\r\n                    (case ReportSubunitPrice.idunit when RDRecordSR.idbaseunit then RDRecordSR.basequantity else (CAST(RDRecordSR.basequantity AS NUMERIC(20,7)))/ReportSubunitPrice.rateofexchange end)\r\n               when  N\'152\' then\r\n                    (case ReportSubunitPrice.idunit when RDRecordSR.idbaseunit then RDRecordSR.basequantity else RDRecordSR.subquantity end)\r\n               end),2, 0),0)) subquantity,\r\n                                        sum(isnull(RDRecordSR.quantity,0)) quantity,\r\n                                        sum(isnull(RDRecordSR.baseQuantity,0)) basequantity ,\r\n                                        RDRecordSR.idSaleDeliveryDetailDTO as idRDRecordDetailDTO \r\n                                        from ST_RDRecord RDRecord,SA_SaleDeliverySourceRelation RDRecordSR,SA_SaleDelivery_b SD\r\n                                        left join V_AA_Inventory as Inventory on SD.idinventory=Inventory.id\r\n                          left join AA_Unit as BaseUnit on SD.idbaseunit=BaseUnit.id \r\n                          left join AA_InventoryUnitPrice as ReportSubunitPrice on ReportSubunitPrice.idunit=inventory.idUnitBySale  and inventory.id=ReportSubunitPrice.Idinventory\r\n                                        where RDRecordSR.sourceVoucherId=RDRecord.id and SD.id=RDRecordSR.idSaleDeliveryDetailDTO\r\n                                        and RDRecordSR.idsourcevouchertype in (select id from SM_VoucherType where code in ( N\'ST1021\', N\'SYS0932\'))\r\n                                        and (SD.sourceVoucherCode= RDRecord.code or  SD.sourceVoucherCode is null)\r\n                                        group by RDRecordSR.idSaleDeliveryDetailDTO) SaleDispatchStatus on SaleDeliveryDetailDTO.id=SaleDispatchStatus.idRDRecordDetailDTO left join AA_Unit SaleOrderUnit  on SaleOrderUnit.id =SaleDispatchStatus.idunit\r\n \r\n                  left join (select \r\n\t\t                sum(ST_RDRecordSourceRelation.quantity) quantity,\r\n\t\t                sum(Round((case BaseUnit.changetype1 \r\n               when  N\'24\' then\r\n                    (case ReportSubunitPrice.idunit when ST_RDRecordSourceRelation.idbaseunit then ST_RDRecordSourceRelation.basequantity else (CAST(ST_RDRecordSourceRelation.basequantity AS NUMERIC(20,7)))/ReportSubunitPrice.rateofexchange end)\r\n               when  N\'152\' then\r\n                    (case ReportSubunitPrice.idunit when ST_RDRecordSourceRelation.idbaseunit then ST_RDRecordSourceRelation.basequantity else ST_RDRecordSourceRelation.subquantity end)\r\n               end),2, 0)) subquantity,\r\n\t\t                sum(ST_RDRecordSourceRelation.basequantity) basequantity,\t\t         \r\n\t\t                ST_RDRecordSourceRelation.sourceVoucherDetailId \r\n\t                from ST_RDRecordSourceRelation,ST_RDRecord ,SA_SaleDelivery_b as SaleDeliverydetail,ST_RDRecord_b b\r\n                    left join V_AA_Inventory as Inventory on b.idinventory=Inventory.id\r\n                          left join AA_Unit as BaseUnit on b.idbaseunit=BaseUnit.id \r\n                          left join AA_InventoryUnitPrice as ReportSubunitPrice on ReportSubunitPrice.idunit=inventory.idUnitBySale  and inventory.id=ReportSubunitPrice.Idinventory\r\n\t                where \r\n\t                ST_RDRecordSourceRelation.voucherid=ST_RDRecord.id \r\n\t                and ST_RDRecordSourceRelation.idRDRecordDetailDTO=b.id\r\n                    and SaleDeliverydetail.id = ST_RDRecordSourceRelation.sourceVoucherDetailId \r\n                    and ST_RDRecordSourceRelation.idsourcevouchertype in (select id from SM_VoucherType where code in (N\'SYS0921\',N\'SA04\'))\r\n                    and isnull(SaleDeliverydetail.quantity,0)*isnull(ST_RDRecordSourceRelation.quantity,0) > 0\r\n\t                and ((0=0 and ST_RDRecord.voucherState<> N\'181\') or (0=1)) \r\n                    \r\n\t                group by ST_RDRecordSourceRelation.sourceVoucherDetailId) as rdRecordByOrder on rdRecordByOrder.sourceVoucherDetailId=SaleDeliveryDetailDTO.Id \r\n               left join (select Min(sa_saleinvoice.saleinvoiceno) saleinvoiceno,\r\n\t\t                sum(SA_SaleInvoice_b.origTaxAmount) origTaxAmount,\r\n\t\t                sum(SA_SaleInvoice_b.taxAmount) taxAmount,\r\n\t\t                sum(origTax) origTax,\r\n\t\t                sum(tax) tax,\r\n                        sum(SA_SaleInvoice_b.origSettleAmount) origSettleAmount,\r\n\t\t                SA_SaleInvoice_b.sourceVoucherDetailId \r\n\t                from SA_SaleInvoice_b,SA_SaleInvoice \r\n\t                where SA_SaleInvoice_b.idsaleInvoiceDTO=SA_SaleInvoice.id and ((0=0 and SA_SaleInvoice.voucherState<> N\'181\') or (0=1))\r\n                    \r\n\t                group by SA_SaleInvoice_b.sourceVoucherDetailId) as SaleInvoiceTaxAmount on SaleInvoiceTaxAmount.sourceVoucherDetailId=SaleDeliveryDetailDTO.id                 left join\r\n                (select \r\n\t\t                            sum(SA_SaleDeliverySourceRelation.quantity) quantity,\r\n\t\t                            sum(SA_SaleDeliverySourceRelation.basequantity) basequantity,\r\n\t\t                            sum(Round((case BaseUnit.changetype1 \r\n               when  N\'24\' then\r\n                    (case ReportSubunitPrice.idunit when SA_SaleDeliverySourceRelation.idbaseunit then SA_SaleDeliverySourceRelation.basequantity else (CAST(SA_SaleDeliverySourceRelation.basequantity AS NUMERIC(20,7)))/ReportSubunitPrice.rateofexchange end)\r\n               when  N\'152\' then\r\n                    (case ReportSubunitPrice.idunit when SA_SaleDeliverySourceRelation.idbaseunit then SA_SaleDeliverySourceRelation.basequantity else SA_SaleDeliverySourceRelation.subquantity end)\r\n               end),2, 0)) subquantity,\r\n\t\t                            SA_SaleDeliverySourceRelation.sourceVoucherDetailId \r\n\t                            from SA_SaleDeliverySourceRelation,SA_SaleDelivery,SA_SaleDelivery_b \r\n                                left join V_AA_Inventory as Inventory on SA_SaleDelivery_b.idinventory=Inventory.id\r\n                          left join AA_Unit as BaseUnit on SA_SaleDelivery_b.idbaseunit=BaseUnit.id \r\n                          left join AA_InventoryUnitPrice as ReportSubunitPrice on ReportSubunitPrice.idunit=inventory.idUnitBySale  and inventory.id=ReportSubunitPrice.Idinventory\r\n                                where \r\n\t                            voucherId=SA_SaleDelivery.id and SA_SaleDelivery.isCounteractDelivery=1 and ((0=0 and SA_SaleDelivery.voucherState<> N\'181\') or (0=1)) \r\n                                and SA_SaleDeliverySourceRelation.idSaleDeliveryDetailDTO=SA_SaleDelivery_b.id\r\n                                and SA_SaleDeliverySourceRelation.idsourcevouchertype in (select id from SM_VoucherType where code in (N\'SYS0921\',N\'SA04\'))\r\n\t                            group by SA_SaleDeliverySourceRelation.sourceVoucherDetailId)\r\n               as CounteractDeliveryQuantity on CounteractDeliveryQuantity.sourceVoucherDetailId=SaleDeliveryDetailDTO.id\r\n             where  1=1  and SaleDelivery.Voucherdate>= N\'2018-09-26\' AND SaleDelivery.Voucherdate<= N\'2018-09-26 22:51:31\' and  SaleDelivery.VoucherState =  N\'??\'',
        islogerror: '1' } } }
[2018-09-26T22:52:14.609] [INFO] httpclires - [login][POST][200]: { code: 200,
  msg: null,
  data: 'eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lJNVpUaGpPR1kyTWkxbFlUSmtMVFE1TXpBdFlXVTRaUzFtTlRCaVpURmhZMkUxTmpZaUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNelV6T0gwLkhWUnV1a1QwUGFWTEk3UldWMl9ndW5SNV9VbGRTT1hUWURVZVIwSmdXZ00tYU8wZjZuVENqcnNwUHNHUnlzclVQdjlSOW9uWkVlc1JkeXdOUFJ6U1dSRWpzUXdKdm9LTmZoOWFiXzFwZmRyYTFfTmw0R1ZXM2FEb01wX3k3MnRkOEtMS2NZZWJ1a0NJSXR1U2I0Sm4welgzbVdHdjR3eG5tSlVzd2lMS3czUSIsIm9yZ0lkIjoiIn0=' }
[2018-09-26T22:52:15.165] [INFO] httpclires - [saleDelivery/QueryExecuting?token=eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lJNVpUaGpPR1kyTWkxbFlUSmtMVFE1TXpBdFlXVTRaUzFtTlRCaVpURmhZMkUxTmpZaUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNelV6T0gwLkhWUnV1a1QwUGFWTEk3UldWMl9ndW5SNV9VbGRTT1hUWURVZVIwSmdXZ00tYU8wZjZuVENqcnNwUHNHUnlzclVQdjlSOW9uWkVlc1JkeXdOUFJ6U1dSRWpzUXdKdm9LTmZoOWFiXzFwZmRyYTFfTmw0R1ZXM2FEb01wX3k3MnRkOEtMS2NZZWJ1a0NJSXR1U2I0Sm4welgzbVdHdjR3eG5tSlVzd2lMS3czUSIsIm9yZ0lkIjoiIn0=][POST][200]: { code: 200,
  msg: null,
  data: 
   { code: 'EXERROR0001',
     message: '245 数据库错误, 请重试!\r\n\r\n在将 nvarchar 值 \'??\' 转换成数据类型 int 时失败。',
     data: 
      { Code: 'EXERROR0001',
        StatusCode: 400,
        sqlstring: ' select  \r\n                --单据表头信息\r\n                SaleDelivery.voucherdate as voucherdate, --单据日期\r\n                SaleDelivery.Code as saleDeliveryCode, --销货单号\r\n                SaleDelivery.externalCode as externalCode, --外部系统编号\r\n               \r\n                SaleDelivery_BusinessType.name as busiTypeName, --业务类型\r\n                SaleDelivery_IsSaleOut.Name as isSaleOut, --出库状态\r\n                SaleDelivery_IsCancel.Name as isCancel, --结算状态\r\n                SaleDelivery.saleInvoiceNo as saleInvoiceNo, --发票号\r\n                Currency.name as CurrencyName, --币种名称\r\n\r\n                SaleDelivery_Customer.Code as partnerCode, --客户编码\r\n                SaleDelivery_Customer.name as partnerName, --客户名称\r\n                SettleCustomer.Code as SettleCustomerCode, --结算客户编码\r\n                SettleCustomer.Name as SettleCustomer, --结算客户名称\r\n                SaleDelivery.deliveryDate as deliveryDate,  --交货日期\r\n                ReciveType.Name as ReciveTypeName, --收款方式\r\n                SaleDelivery.recivingMaturity as recivingMaturity,--收款到期日\r\n                SaleDelivery.address as address, --送货地址\r\n                SaleDelivery.linkMan as linkMan, --联系人\r\n                SaleDelivery.Memo as Memo, --备注\r\n            \r\n \r\n                --单据表体信息\r\n                Warehouse.code as warehouseCode, --仓库编码\r\n                Warehouse.name as warehouseName, --仓库名称\r\n                SaleDeliveryDetailDTO.InventoryBarCode as InventoryBarCode, --条形码\r\n\r\n                Inventory.code as inventoryCode,   --存货编码\r\n                Inventory.name as inventoryName, --存货名称\r\n                Inventory.specification as specification, --规格型号\r\n                Brand.Name as BrandName, --品牌\r\n                SaleDeliveryDetailDTO.freeItem0 as freeItem0, --自由项1\r\n                SaleDeliveryDetailDTO.freeItem1 as freeItem1, --自由项2\r\n                SaleDeliveryDetailDTO.freeItem2 as freeItem2, --自由项3\r\n                SaleDeliveryDetailDTO.freeItem3 as freeItem3, --自由项4\r\n                SaleDeliveryDetailDTO.freeItem4 as freeItem4, --自由项5\r\n                SaleDeliveryDetailDTO.freeItem5 as freeItem5, --自由项6\r\n                SaleDeliveryDetailDTO.freeItem6 as freeItem6, --自由项7\r\n                SaleDeliveryDetailDTO.freeItem7 as freeItem7, --自由项8\r\n                SaleDeliveryDetailDTO.freeItem8 as freeItem8, --自由项9\r\n                SaleDeliveryDetailDTO.freeItem9 as freeItem9, --自由项10\r\n\r\n                Unit.name as unitName, --销售单位\r\n                SaleDeliveryDetailDTO.Batch as Batch, --批号\r\n                SaleDeliveryDetailDTO.ProductionDate as ProductionDate, --生产日期\r\n                SaleDeliveryDetailDTO.ExpiryDate as ExpiryDate, --失效日期\r\n            \r\n\r\n                SaleDeliveryDetailDTO.quantity as quantity, --数量（销售单位）\r\n                SaleDeliveryDetailDTO.origTaxPrice as origTaxPrice, --含税单价\r\n                SaleDeliveryDetailDTO.origTaxAmount as origTaxAmount, --含税金额  { rDRecordQuantity}  as rDRecordQuantity, --累计出库数量\r\n   ArapSettleAmount.origSettleAmount  as detailOrigSettleAmount, --累计结算金额\r\n  SaleInvoiceQuantity.quantity  as saleInvoiceQuantity, --累计开票数量（销售单位）\r\n  SaleInvoiceTaxAmount.origTaxAmount  as saleInvoiceOrigAmount --累计开票金额\r\n from  \r\n                SA_SaleDelivery_b as SaleDeliveryDetailDTO\r\n                Inner join SA_SaleDelivery as SaleDelivery on SaleDeliveryDetailDTO.idSaleDeliveryDTO=SaleDelivery.id and ( N\'All\'= N\'All\' or ( N\'All\'= N\'TheSame\' and SaleDelivery.idcustomer = SaleDelivery.idsettleCustomer) or ( N\'All\'= N\'InDifferent\' and SaleDelivery.idcustomer <> SaleDelivery.idsettleCustomer))\r\n                left join  AA_BusiType as SaleDelivery_BusinessType on SaleDelivery.idbusinesstype=SaleDelivery_BusinessType.id\r\n                left join  eap_EnumItem as SaleDelivery_IsSaleOut on SaleDelivery_IsSaleOut.id=SaleDelivery.isSaleOut\r\n                left join  eap_EnumItem as SaleDelivery_IsCancel on SaleDelivery_IsCancel.id=SaleDelivery.isCancel\r\n                left join  eap_EnumItem  as ReciveType on SaleDelivery.reciveType=ReciveType.id\r\n                left join  AA_Partner as SaleDelivery_Customer on SaleDelivery.idcustomer=SaleDelivery_Customer.id\r\n                left join AA_Currency as Currency on SaleDelivery.idcurrency = Currency.id\r\n                left join AA_Warehouse as Warehouse on SaleDeliveryDetailDTO.idwarehouse=Warehouse.id\r\n                left join AA_Partner  as SettleCustomer on SaleDelivery.idsettleCustomer=SettleCustomer.id\r\n                Inner join AA_Inventory as Inventory on SaleDeliveryDetailDTO.idinventory=Inventory.id \r\n                left join  eap_EnumItem  as Brand on Inventory.productInfo=Brand.id\r\n                left join AA_Unit as Unit on SaleDeliveryDetailDTO.idunit=Unit.id\r\n                \r\n       \r\n              \r\n left join(select \r\n                                    sum(SA_SaleInvoiceSourceRelation.quantity) quantity,\r\n                                    sum(Round((case BaseUnit.changetype1 \r\n               when  N\'24\' then\r\n                    (case ReportSubunitPrice.idunit when SA_SaleInvoiceSourceRelation.idbaseunit then SA_SaleInvoiceSourceRelation.basequantity else (CAST(SA_SaleInvoiceSourceRelation.basequantity AS NUMERIC(20,7)))/ReportSubunitPrice.rateofexchange end)\r\n               when  N\'152\' then\r\n                    (case ReportSubunitPrice.idunit when SA_SaleInvoiceSourceRelation.idbaseunit then SA_SaleInvoiceSourceRelation.basequantity else SA_SaleInvoiceSourceRelation.subquantity end)\r\n               end),2, 0)) subquantity,\r\n                                    sum(SA_SaleInvoiceSourceRelation.basequantity) basequantity,\t\t              \r\n                                    SA_SaleInvoiceSourceRelation.sourceVoucherDetailId \r\n                                    from SA_SaleInvoiceSourceRelation,SA_SaleInvoice,sa_saleinvoice_b \r\n                                     --app接口没有辅单位取值条件，sqlContext赋值为null表示取默认值\r\n                                    left join V_AA_Inventory as Inventory on sa_saleinvoice_b.idinventory=Inventory.id\r\n                          left join AA_Unit as BaseUnit on sa_saleinvoice_b.idbaseunit=BaseUnit.id \r\n                          left join AA_InventoryUnitPrice as ReportSubunitPrice on ReportSubunitPrice.idunit=inventory.idUnitBySale  and inventory.id=ReportSubunitPrice.Idinventory\r\n                                    where \r\n                                    SA_SaleInvoiceSourceRelation.voucherid=SA_SaleInvoice.id \r\n                                    and SA_SaleInvoiceSourceRelation.idsaleinvoicedetaildto=sa_saleinvoice_b.id \r\n                                    and sa_saleinvoice_b.sourceVoucherDetailId=SA_SaleInvoiceSourceRelation.sourceVoucherDetailId \r\n                                    and ((0=0 and SA_SaleInvoice.voucherState<> N\'181\') or (0=1))\r\n                                    group by SA_SaleInvoiceSourceRelation.sourceVoucherDetailId)\r\n\t                                as \tSaleInvoiceQuantity on    SaleInvoiceQuantity.sourceVoucherDetailId=SaleDeliveryDetailDTO.id \r\n LEFT JOIN ( select \r\n                                                                 SUM(xxx.origCurrentAmount) origsettleamount,\r\n                                                                 SUM(xxx.currentAmount) settleamount,\r\n                                                                 xxx.voucherDetailID\r\n                                                        from (\r\n                                                                select  SUM(Isnull(arap_b.origCurrentAmount,0)) origCurrentAmount,\r\n                                                                        SUM(Isnull(arap_b.currentAmount,0)) currentAmount,\r\n                                                                        arap_b.voucherDetailID\r\n                                                                from ARAP_ReceivePayment_b arap_b\r\n                                                                left join ARAP_ReceivePayment arap on arap_b.idArapReceivePaymentDTO=arap.id\r\n                                                                where arap.voucherState= N\'189\'\r\n                                                                group by arap_b.voucherDetailID\r\n                                                                union all\r\n                                                                select  SUM(Isnull(arsb_b.origCurrentAmount,0)) origCurrentAmount,\r\n                                                                        SUM(Isnull(arsb_b.currentAmount,0)) currentAmount,\r\n                                                                        arsb_b.voucherDetailID\r\n                                                                from ARAP_StrikeBalance_SecondDetail arsb_b\r\n                                                                left join ARAP_StrikeBalance arsb on arsb_b.idArapStrikeBalanceDTO=arsb.id\r\n                                                                where arsb.voucherState= N\'189\' and  arsb.idfirstpartner =arsb.idsecondpartner \r\n                                                                group by arsb_b.voucherDetailID\r\n                                                                 union all\r\n                                                                --应收冲应收 \r\n                                                                select SUM(ISNULL(firstdetail.origCurrentAmount,0)) origcurrentamount,\r\n\t\t\t\t\t\t\t\t\t                            SUM(ISNULL(firstdetail.currentAmount,0)) currentamount,\r\n\t\t\t\t\t\t\t\t\t                            firstdetail.voucherDetailID\r\n                                                                from arap_strikebalance_firstdetail firstdetail\r\n\t\t\t\t\t\t\t\t\t\t                        left join ARAP_StrikeBalance arsb\r\n\t\t\t\t\t\t\t\t\t\t                        on\tfirstdetail.idArapStrikeBalanceDTO=arsb.id\r\n\t\t\t\t\t\t\t\t\t\t                        where arsb.voucherState= N\'189\'\r\n                                                                 and  (arsb.idbusitype <>  N\'12\' or (arsb.idbusitype =  N\'12\' and arsb.idfirstpartner =arsb.idsecondpartner )) \r\n\t\t\t\t\t\t\t\t                                group by firstdetail.voucherDetailID\r\n                                                        ) xxx\r\n                                                        group by xxx.voucherDetailID\r\n\t\t\t\t                                    ) arapsettleamount ON arapsettleamount.voucherDetailID = SaleDeliveryDetailDTO.id   \r\n                                       \r\n                           left join (select distinct\r\n                                        max(cast( RDRecordSR.idunit as varchar(50)))idunit,\r\n                                        max(RDRecord.code) code,\r\n                                        max(RDRecord.voucherdate) voucherdate,\r\n                                        sum(isnull(Round((case BaseUnit.changetype1 \r\n               when  N\'24\' then\r\n                    (case ReportSubunitPrice.idunit when RDRecordSR.idbaseunit then RDRecordSR.basequantity else (CAST(RDRecordSR.basequantity AS NUMERIC(20,7)))/ReportSubunitPrice.rateofexchange end)\r\n               when  N\'152\' then\r\n                    (case ReportSubunitPrice.idunit when RDRecordSR.idbaseunit then RDRecordSR.basequantity else RDRecordSR.subquantity end)\r\n               end),2, 0),0)) subquantity,\r\n                                        sum(isnull(RDRecordSR.quantity,0)) quantity,\r\n                                        sum(isnull(RDRecordSR.baseQuantity,0)) basequantity ,\r\n                                        RDRecordSR.idSaleDeliveryDetailDTO as idRDRecordDetailDTO \r\n                                        from ST_RDRecord RDRecord,SA_SaleDeliverySourceRelation RDRecordSR,SA_SaleDelivery_b SD\r\n                                        left join V_AA_Inventory as Inventory on SD.idinventory=Inventory.id\r\n                          left join AA_Unit as BaseUnit on SD.idbaseunit=BaseUnit.id \r\n                          left join AA_InventoryUnitPrice as ReportSubunitPrice on ReportSubunitPrice.idunit=inventory.idUnitBySale  and inventory.id=ReportSubunitPrice.Idinventory\r\n                                        where RDRecordSR.sourceVoucherId=RDRecord.id and SD.id=RDRecordSR.idSaleDeliveryDetailDTO\r\n                                        and RDRecordSR.idsourcevouchertype in (select id from SM_VoucherType where code in ( N\'ST1021\', N\'SYS0932\'))\r\n                                        and (SD.sourceVoucherCode= RDRecord.code or  SD.sourceVoucherCode is null)\r\n                                        group by RDRecordSR.idSaleDeliveryDetailDTO) SaleDispatchStatus on SaleDeliveryDetailDTO.id=SaleDispatchStatus.idRDRecordDetailDTO left join AA_Unit SaleOrderUnit  on SaleOrderUnit.id =SaleDispatchStatus.idunit\r\n \r\n                  left join (select \r\n\t\t                sum(ST_RDRecordSourceRelation.quantity) quantity,\r\n\t\t                sum(Round((case BaseUnit.changetype1 \r\n               when  N\'24\' then\r\n                    (case ReportSubunitPrice.idunit when ST_RDRecordSourceRelation.idbaseunit then ST_RDRecordSourceRelation.basequantity else (CAST(ST_RDRecordSourceRelation.basequantity AS NUMERIC(20,7)))/ReportSubunitPrice.rateofexchange end)\r\n               when  N\'152\' then\r\n                    (case ReportSubunitPrice.idunit when ST_RDRecordSourceRelation.idbaseunit then ST_RDRecordSourceRelation.basequantity else ST_RDRecordSourceRelation.subquantity end)\r\n               end),2, 0)) subquantity,\r\n\t\t                sum(ST_RDRecordSourceRelation.basequantity) basequantity,\t\t         \r\n\t\t                ST_RDRecordSourceRelation.sourceVoucherDetailId \r\n\t                from ST_RDRecordSourceRelation,ST_RDRecord ,SA_SaleDelivery_b as SaleDeliverydetail,ST_RDRecord_b b\r\n                    left join V_AA_Inventory as Inventory on b.idinventory=Inventory.id\r\n                          left join AA_Unit as BaseUnit on b.idbaseunit=BaseUnit.id \r\n                          left join AA_InventoryUnitPrice as ReportSubunitPrice on ReportSubunitPrice.idunit=inventory.idUnitBySale  and inventory.id=ReportSubunitPrice.Idinventory\r\n\t                where \r\n\t                ST_RDRecordSourceRelation.voucherid=ST_RDRecord.id \r\n\t                and ST_RDRecordSourceRelation.idRDRecordDetailDTO=b.id\r\n                    and SaleDeliverydetail.id = ST_RDRecordSourceRelation.sourceVoucherDetailId \r\n                    and ST_RDRecordSourceRelation.idsourcevouchertype in (select id from SM_VoucherType where code in (N\'SYS0921\',N\'SA04\'))\r\n                    and isnull(SaleDeliverydetail.quantity,0)*isnull(ST_RDRecordSourceRelation.quantity,0) > 0\r\n\t                and ((0=0 and ST_RDRecord.voucherState<> N\'181\') or (0=1)) \r\n                    \r\n\t                group by ST_RDRecordSourceRelation.sourceVoucherDetailId) as rdRecordByOrder on rdRecordByOrder.sourceVoucherDetailId=SaleDeliveryDetailDTO.Id \r\n               left join (select Min(sa_saleinvoice.saleinvoiceno) saleinvoiceno,\r\n\t\t                sum(SA_SaleInvoice_b.origTaxAmount) origTaxAmount,\r\n\t\t                sum(SA_SaleInvoice_b.taxAmount) taxAmount,\r\n\t\t                sum(origTax) origTax,\r\n\t\t                sum(tax) tax,\r\n                        sum(SA_SaleInvoice_b.origSettleAmount) origSettleAmount,\r\n\t\t                SA_SaleInvoice_b.sourceVoucherDetailId \r\n\t                from SA_SaleInvoice_b,SA_SaleInvoice \r\n\t                where SA_SaleInvoice_b.idsaleInvoiceDTO=SA_SaleInvoice.id and ((0=0 and SA_SaleInvoice.voucherState<> N\'181\') or (0=1))\r\n                    \r\n\t                group by SA_SaleInvoice_b.sourceVoucherDetailId) as SaleInvoiceTaxAmount on SaleInvoiceTaxAmount.sourceVoucherDetailId=SaleDeliveryDetailDTO.id                 left join\r\n                (select \r\n\t\t                            sum(SA_SaleDeliverySourceRelation.quantity) quantity,\r\n\t\t                            sum(SA_SaleDeliverySourceRelation.basequantity) basequantity,\r\n\t\t                            sum(Round((case BaseUnit.changetype1 \r\n               when  N\'24\' then\r\n                    (case ReportSubunitPrice.idunit when SA_SaleDeliverySourceRelation.idbaseunit then SA_SaleDeliverySourceRelation.basequantity else (CAST(SA_SaleDeliverySourceRelation.basequantity AS NUMERIC(20,7)))/ReportSubunitPrice.rateofexchange end)\r\n               when  N\'152\' then\r\n                    (case ReportSubunitPrice.idunit when SA_SaleDeliverySourceRelation.idbaseunit then SA_SaleDeliverySourceRelation.basequantity else SA_SaleDeliverySourceRelation.subquantity end)\r\n               end),2, 0)) subquantity,\r\n\t\t                            SA_SaleDeliverySourceRelation.sourceVoucherDetailId \r\n\t                            from SA_SaleDeliverySourceRelation,SA_SaleDelivery,SA_SaleDelivery_b \r\n                                left join V_AA_Inventory as Inventory on SA_SaleDelivery_b.idinventory=Inventory.id\r\n                          left join AA_Unit as BaseUnit on SA_SaleDelivery_b.idbaseunit=BaseUnit.id \r\n                          left join AA_InventoryUnitPrice as ReportSubunitPrice on ReportSubunitPrice.idunit=inventory.idUnitBySale  and inventory.id=ReportSubunitPrice.Idinventory\r\n                                where \r\n\t                            voucherId=SA_SaleDelivery.id and SA_SaleDelivery.isCounteractDelivery=1 and ((0=0 and SA_SaleDelivery.voucherState<> N\'181\') or (0=1)) \r\n                                and SA_SaleDeliverySourceRelation.idSaleDeliveryDetailDTO=SA_SaleDelivery_b.id\r\n                                and SA_SaleDeliverySourceRelation.idsourcevouchertype in (select id from SM_VoucherType where code in (N\'SYS0921\',N\'SA04\'))\r\n\t                            group by SA_SaleDeliverySourceRelation.sourceVoucherDetailId)\r\n               as CounteractDeliveryQuantity on CounteractDeliveryQuantity.sourceVoucherDetailId=SaleDeliveryDetailDTO.id\r\n             where  1=1  and SaleDelivery.Voucherdate>= N\'2018-09-26\' AND SaleDelivery.Voucherdate<= N\'2018-09-26 22:52:13\' and  SaleDelivery.VoucherState =  N\'??\'',
        islogerror: '1' } } }
[2018-09-26T22:52:19.782] [INFO] httpclires - [login][POST][200]: { code: 200,
  msg: null,
  data: 'eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lKaE9HWTVOelkzWmkwMFpqVmxMVFEyTnpBdE9UZGlOaTAzTnpZd01XUTVNVEEyTmpVaUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNelUwTTMwLkYtU2YzNF8yandrMW52T1l3SkJUYllPR1dzOUJNUHFuSzBjbnZpN1ltUjBMc2l1SmlYakYtbk81dmw2NW5xTUVkQ3lDemFPenVZMUowZHhaQU5MZmhYWkFfQ2xRSUFNQjBQR0xKVnR0WGwyRzZSY0xIV2E2RU9mODZNTFVtamRGZ0NTSDhMd3JLV20wdWJHUi12SlZSX1VlZDktYjMwRjh2dFZCWlVEQUJNYyIsIm9yZ0lkIjoiIn0=' }
[2018-09-26T22:52:20.511] [INFO] httpclires - [saleDelivery/QueryExecuting?token=eyJhcHBLZXkiOiI1ZTYwYjdhNi1kZGQ5LTRhOTctYThhMy1hMzE3OGJkYjYwMDQiLCJhdXRoSW5mbyI6ImV5SmhiR2NpT2lKUVV6STFOaUo5LmV5SmhZMk5sYzNOZmRHOXJaVzRpT2lKaE9HWTVOelkzWmkwMFpqVmxMVFEyTnpBdE9UZGlOaTAzTnpZd01XUTVNVEEyTmpVaUxDSnpkV0lpT2lKbExXTnZiVzFsY21ObElpd2laR0YwWVhNaU9pSTNOMlE1WVRSaE5ESmxNV0kyTWpVMU1HUTBZekU1TXpNNFltUm1NMlZtTXlJc0ltVjRjQ0k2TVRVek9EQXdNelUwTTMwLkYtU2YzNF8yandrMW52T1l3SkJUYllPR1dzOUJNUHFuSzBjbnZpN1ltUjBMc2l1SmlYakYtbk81dmw2NW5xTUVkQ3lDemFPenVZMUowZHhaQU5MZmhYWkFfQ2xRSUFNQjBQR0xKVnR0WGwyRzZSY0xIV2E2RU9mODZNTFVtamRGZ0NTSDhMd3JLV20wdWJHUi12SlZSX1VlZDktYjMwRjh2dFZCWlVEQUJNYyIsIm9yZ0lkIjoiIn0=][POST][200]: { code: 200,
  msg: null,
  data: 
   { code: 'EXERROR0001',
     message: '245 数据库错误, 请重试!\r\n\r\n在将 nvarchar 值 \'??\' 转换成数据类型 int 时失败。',
     data: 
      { Code: 'EXERROR0001',
        StatusCode: 400,
        sqlstring: ' select  \r\n                --单据表头信息\r\n                SaleDelivery.voucherdate as voucherdate, --单据日期\r\n                SaleDelivery.Code as saleDeliveryCode, --销货单号\r\n                SaleDelivery.externalCode as externalCode, --外部系统编号\r\n               \r\n                SaleDelivery_BusinessType.name as busiTypeName, --业务类型\r\n                SaleDelivery_IsSaleOut.Name as isSaleOut, --出库状态\r\n                SaleDelivery_IsCancel.Name as isCancel, --结算状态\r\n                SaleDelivery.saleInvoiceNo as saleInvoiceNo, --发票号\r\n                Currency.name as CurrencyName, --币种名称\r\n\r\n                SaleDelivery_Customer.Code as partnerCode, --客户编码\r\n                SaleDelivery_Customer.name as partnerName, --客户名称\r\n                SettleCustomer.Code as SettleCustomerCode, --结算客户编码\r\n                SettleCustomer.Name as SettleCustomer, --结算客户名称\r\n                SaleDelivery.deliveryDate as deliveryDate,  --交货日期\r\n                ReciveType.Name as ReciveTypeName, --收款方式\r\n                SaleDelivery.recivingMaturity as recivingMaturity,--收款到期日\r\n                SaleDelivery.address as address, --送货地址\r\n                SaleDelivery.linkMan as linkMan, --联系人\r\n                SaleDelivery.Memo as Memo, --备注\r\n            \r\n \r\n                --单据表体信息\r\n                Warehouse.code as warehouseCode, --仓库编码\r\n                Warehouse.name as warehouseName, --仓库名称\r\n                SaleDeliveryDetailDTO.InventoryBarCode as InventoryBarCode, --条形码\r\n\r\n                Inventory.code as inventoryCode,   --存货编码\r\n                Inventory.name as inventoryName, --存货名称\r\n                Inventory.specification as specification, --规格型号\r\n                Brand.Name as BrandName, --品牌\r\n                SaleDeliveryDetailDTO.freeItem0 as freeItem0, --自由项1\r\n                SaleDeliveryDetailDTO.freeItem1 as freeItem1, --自由项2\r\n                SaleDeliveryDetailDTO.freeItem2 as freeItem2, --自由项3\r\n                SaleDeliveryDetailDTO.freeItem3 as freeItem3, --自由项4\r\n                SaleDeliveryDetailDTO.freeItem4 as freeItem4, --自由项5\r\n                SaleDeliveryDetailDTO.freeItem5 as freeItem5, --自由项6\r\n                SaleDeliveryDetailDTO.freeItem6 as freeItem6, --自由项7\r\n                SaleDeliveryDetailDTO.freeItem7 as freeItem7, --自由项8\r\n                SaleDeliveryDetailDTO.freeItem8 as freeItem8, --自由项9\r\n                SaleDeliveryDetailDTO.freeItem9 as freeItem9, --自由项10\r\n\r\n                Unit.name as unitName, --销售单位\r\n                SaleDeliveryDetailDTO.Batch as Batch, --批号\r\n                SaleDeliveryDetailDTO.ProductionDate as ProductionDate, --生产日期\r\n                SaleDeliveryDetailDTO.ExpiryDate as ExpiryDate, --失效日期\r\n            \r\n\r\n                SaleDeliveryDetailDTO.quantity as quantity, --数量（销售单位）\r\n                SaleDeliveryDetailDTO.origTaxPrice as origTaxPrice, --含税单价\r\n                SaleDeliveryDetailDTO.origTaxAmount as origTaxAmount, --含税金额  { rDRecordQuantity}  as rDRecordQuantity, --累计出库数量\r\n   ArapSettleAmount.origSettleAmount  as detailOrigSettleAmount, --累计结算金额\r\n  SaleInvoiceQuantity.quantity  as saleInvoiceQuantity, --累计开票数量（销售单位）\r\n  SaleInvoiceTaxAmount.origTaxAmount  as saleInvoiceOrigAmount --累计开票金额\r\n from  \r\n                SA_SaleDelivery_b as SaleDeliveryDetailDTO\r\n                Inner join SA_SaleDelivery as SaleDelivery on SaleDeliveryDetailDTO.idSaleDeliveryDTO=SaleDelivery.id and ( N\'All\'= N\'All\' or ( N\'All\'= N\'TheSame\' and SaleDelivery.idcustomer = SaleDelivery.idsettleCustomer) or ( N\'All\'= N\'InDifferent\' and SaleDelivery.idcustomer <> SaleDelivery.idsettleCustomer))\r\n                left join  AA_BusiType as SaleDelivery_BusinessType on SaleDelivery.idbusinesstype=SaleDelivery_BusinessType.id\r\n                left join  eap_EnumItem as SaleDelivery_IsSaleOut on SaleDelivery_IsSaleOut.id=SaleDelivery.isSaleOut\r\n                left join  eap_EnumItem as SaleDelivery_IsCancel on SaleDelivery_IsCancel.id=SaleDelivery.isCancel\r\n                left join  eap_EnumItem  as ReciveType on SaleDelivery.reciveType=ReciveType.id\r\n                left join  AA_Partner as SaleDelivery_Customer on SaleDelivery.idcustomer=SaleDelivery_Customer.id\r\n                left join AA_Currency as Currency on SaleDelivery.idcurrency = Currency.id\r\n                left join AA_Warehouse as Warehouse on SaleDeliveryDetailDTO.idwarehouse=Warehouse.id\r\n                left join AA_Partner  as SettleCustomer on SaleDelivery.idsettleCustomer=SettleCustomer.id\r\n                Inner join AA_Inventory as Inventory on SaleDeliveryDetailDTO.idinventory=Inventory.id \r\n                left join  eap_EnumItem  as Brand on Inventory.productInfo=Brand.id\r\n                left join AA_Unit as Unit on SaleDeliveryDetailDTO.idunit=Unit.id\r\n                \r\n       \r\n              \r\n left join(select \r\n                                    sum(SA_SaleInvoiceSourceRelation.quantity) quantity,\r\n                                    sum(Round((case BaseUnit.changetype1 \r\n               when  N\'24\' then\r\n                    (case ReportSubunitPrice.idunit when SA_SaleInvoiceSourceRelation.idbaseunit then SA_SaleInvoiceSourceRelation.basequantity else (CAST(SA_SaleInvoiceSourceRelation.basequantity AS NUMERIC(20,7)))/ReportSubunitPrice.rateofexchange end)\r\n               when  N\'152\' then\r\n                    (case ReportSubunitPrice.idunit when SA_SaleInvoiceSourceRelation.idbaseunit then SA_SaleInvoiceSourceRelation.basequantity else SA_SaleInvoiceSourceRelation.subquantity end)\r\n               end),2, 0)) subquantity,\r\n                                    sum(SA_SaleInvoiceSourceRelation.basequantity) basequantity,\t\t              \r\n                                    SA_SaleInvoiceSourceRelation.sourceVoucherDetailId \r\n                                    from SA_SaleInvoiceSourceRelation,SA_SaleInvoice,sa_saleinvoice_b \r\n                                     --app接口没有辅单位取值条件，sqlContext赋值为null表示取默认值\r\n                                    left join V_AA_Inventory as Inventory on sa_saleinvoice_b.idinventory=Inventory.id\r\n                          left join AA_Unit as BaseUnit on sa_saleinvoice_b.idbaseunit=BaseUnit.id \r\n                          left join AA_InventoryUnitPrice as ReportSubunitPrice on ReportSubunitPrice.idunit=inventory.idUnitBySale  and inventory.id=ReportSubunitPrice.Idinventory\r\n                                    where \r\n                                    SA_SaleInvoiceSourceRelation.voucherid=SA_SaleInvoice.id \r\n                                    and SA_SaleInvoiceSourceRelation.idsaleinvoicedetaildto=sa_saleinvoice_b.id \r\n                                    and sa_saleinvoice_b.sourceVoucherDetailId=SA_SaleInvoiceSourceRelation.sourceVoucherDetailId \r\n                                    and ((0=0 and SA_SaleInvoice.voucherState<> N\'181\') or (0=1))\r\n                                    group by SA_SaleInvoiceSourceRelation.sourceVoucherDetailId)\r\n\t                                as \tSaleInvoiceQuantity on    SaleInvoiceQuantity.sourceVoucherDetailId=SaleDeliveryDetailDTO.id \r\n LEFT JOIN ( select \r\n                                                                 SUM(xxx.origCurrentAmount) origsettleamount,\r\n                                                                 SUM(xxx.currentAmount) settleamount,\r\n                                                                 xxx.voucherDetailID\r\n                                                        from (\r\n                                                                select  SUM(Isnull(arap_b.origCurrentAmount,0)) origCurrentAmount,\r\n                                                                        SUM(Isnull(arap_b.currentAmount,0)) currentAmount,\r\n                                                                        arap_b.voucherDetailID\r\n                                                                from ARAP_ReceivePayment_b arap_b\r\n                                                                left join ARAP_ReceivePayment arap on arap_b.idArapReceivePaymentDTO=arap.id\r\n                                                                where arap.voucherState= N\'189\'\r\n                                                                group by arap_b.voucherDetailID\r\n                                                                union all\r\n                                                                select  SUM(Isnull(arsb_b.origCurrentAmount,0)) origCurrentAmount,\r\n                                                                        SUM(Isnull(arsb_b.currentAmount,0)) currentAmount,\r\n                                                                        arsb_b.voucherDetailID\r\n                                                                from ARAP_StrikeBalance_SecondDetail arsb_b\r\n                                                                left join ARAP_StrikeBalance arsb on arsb_b.idArapStrikeBalanceDTO=arsb.id\r\n                                                                where arsb.voucherState= N\'189\' and  arsb.idfirstpartner =arsb.idsecondpartner \r\n                                                                group by arsb_b.voucherDetailID\r\n                                                                 union all\r\n                                                                --应收冲应收 \r\n                                                                select SUM(ISNULL(firstdetail.origCurrentAmount,0)) origcurrentamount,\r\n\t\t\t\t\t\t\t\t\t                            SUM(ISNULL(firstdetail.currentAmount,0)) currentamount,\r\n\t\t\t\t\t\t\t\t\t                            firstdetail.voucherDetailID\r\n                                                                from arap_strikebalance_firstdetail firstdetail\r\n\t\t\t\t\t\t\t\t\t\t                        left join ARAP_StrikeBalance arsb\r\n\t\t\t\t\t\t\t\t\t\t                        on\tfirstdetail.idArapStrikeBalanceDTO=arsb.id\r\n\t\t\t\t\t\t\t\t\t\t                        where arsb.voucherState= N\'189\'\r\n                                                                 and  (arsb.idbusitype <>  N\'12\' or (arsb.idbusitype =  N\'12\' and arsb.idfirstpartner =arsb.idsecondpartner )) \r\n\t\t\t\t\t\t\t\t                                group by firstdetail.voucherDetailID\r\n                                                        ) xxx\r\n                                                        group by xxx.voucherDetailID\r\n\t\t\t\t                                    ) arapsettleamount ON arapsettleamount.voucherDetailID = SaleDeliveryDetailDTO.id   \r\n                                       \r\n                           left join (select distinct\r\n                                        max(cast( RDRecordSR.idunit as varchar(50)))idunit,\r\n                                        max(RDRecord.code) code,\r\n                                        max(RDRecord.voucherdate) voucherdate,\r\n                                        sum(isnull(Round((case BaseUnit.changetype1 \r\n               when  N\'24\' then\r\n                    (case ReportSubunitPrice.idunit when RDRecordSR.idbaseunit then RDRecordSR.basequantity else (CAST(RDRecordSR.basequantity AS NUMERIC(20,7)))/ReportSubunitPrice.rateofexchange end)\r\n               when  N\'152\' then\r\n                    (case ReportSubunitPrice.idunit when RDRecordSR.idbaseunit then RDRecordSR.basequantity else RDRecordSR.subquantity end)\r\n               end),2, 0),0)) subquantity,\r\n                                        sum(isnull(RDRecordSR.quantity,0)) quantity,\r\n                                        sum(isnull(RDRecordSR.baseQuantity,0)) basequantity ,\r\n                                        RDRecordSR.idSaleDeliveryDetailDTO as idRDRecordDetailDTO \r\n                                        from ST_RDRecord RDRecord,SA_SaleDeliverySourceRelation RDRecordSR,SA_SaleDelivery_b SD\r\n                                        left join V_AA_Inventory as Inventory on SD.idinventory=Inventory.id\r\n                          left join AA_Unit as BaseUnit on SD.idbaseunit=BaseUnit.id \r\n                          left join AA_InventoryUnitPrice as ReportSubunitPrice on ReportSubunitPrice.idunit=inventory.idUnitBySale  and inventory.id=ReportSubunitPrice.Idinventory\r\n                                        where RDRecordSR.sourceVoucherId=RDRecord.id and SD.id=RDRecordSR.idSaleDeliveryDetailDTO\r\n                                        and RDRecordSR.idsourcevouchertype in (select id from SM_VoucherType where code in ( N\'ST1021\', N\'SYS0932\'))\r\n                                        and (SD.sourceVoucherCode= RDRecord.code or  SD.sourceVoucherCode is null)\r\n                                        group by RDRecordSR.idSaleDeliveryDetailDTO) SaleDispatchStatus on SaleDeliveryDetailDTO.id=SaleDispatchStatus.idRDRecordDetailDTO left join AA_Unit SaleOrderUnit  on SaleOrderUnit.id =SaleDispatchStatus.idunit\r\n \r\n                  left join (select \r\n\t\t                sum(ST_RDRecordSourceRelation.quantity) quantity,\r\n\t\t                sum(Round((case BaseUnit.changetype1 \r\n               when  N\'24\' then\r\n                    (case ReportSubunitPrice.idunit when ST_RDRecordSourceRelation.idbaseunit then ST_RDRecordSourceRelation.basequantity else (CAST(ST_RDRecordSourceRelation.basequantity AS NUMERIC(20,7)))/ReportSubunitPrice.rateofexchange end)\r\n               when  N\'152\' then\r\n                    (case ReportSubunitPrice.idunit when ST_RDRecordSourceRelation.idbaseunit then ST_RDRecordSourceRelation.basequantity else ST_RDRecordSourceRelation.subquantity end)\r\n               end),2, 0)) subquantity,\r\n\t\t                sum(ST_RDRecordSourceRelation.basequantity) basequantity,\t\t         \r\n\t\t                ST_RDRecordSourceRelation.sourceVoucherDetailId \r\n\t                from ST_RDRecordSourceRelation,ST_RDRecord ,SA_SaleDelivery_b as SaleDeliverydetail,ST_RDRecord_b b\r\n                    left join V_AA_Inventory as Inventory on b.idinventory=Inventory.id\r\n                          left join AA_Unit as BaseUnit on b.idbaseunit=BaseUnit.id \r\n                          left join AA_InventoryUnitPrice as ReportSubunitPrice on ReportSubunitPrice.idunit=inventory.idUnitBySale  and inventory.id=ReportSubunitPrice.Idinventory\r\n\t                where \r\n\t                ST_RDRecordSourceRelation.voucherid=ST_RDRecord.id \r\n\t                and ST_RDRecordSourceRelation.idRDRecordDetailDTO=b.id\r\n                    and SaleDeliverydetail.id = ST_RDRecordSourceRelation.sourceVoucherDetailId \r\n                    and ST_RDRecordSourceRelation.idsourcevouchertype in (select id from SM_VoucherType where code in (N\'SYS0921\',N\'SA04\'))\r\n                    and isnull(SaleDeliverydetail.quantity,0)*isnull(ST_RDRecordSourceRelation.quantity,0) > 0\r\n\t                and ((0=0 and ST_RDRecord.voucherState<> N\'181\') or (0=1)) \r\n                    \r\n\t                group by ST_RDRecordSourceRelation.sourceVoucherDetailId) as rdRecordByOrder on rdRecordByOrder.sourceVoucherDetailId=SaleDeliveryDetailDTO.Id \r\n               left join (select Min(sa_saleinvoice.saleinvoiceno) saleinvoiceno,\r\n\t\t                sum(SA_SaleInvoice_b.origTaxAmount) origTaxAmount,\r\n\t\t                sum(SA_SaleInvoice_b.taxAmount) taxAmount,\r\n\t\t                sum(origTax) origTax,\r\n\t\t                sum(tax) tax,\r\n                        sum(SA_SaleInvoice_b.origSettleAmount) origSettleAmount,\r\n\t\t                SA_SaleInvoice_b.sourceVoucherDetailId \r\n\t                from SA_SaleInvoice_b,SA_SaleInvoice \r\n\t                where SA_SaleInvoice_b.idsaleInvoiceDTO=SA_SaleInvoice.id and ((0=0 and SA_SaleInvoice.voucherState<> N\'181\') or (0=1))\r\n                    \r\n\t                group by SA_SaleInvoice_b.sourceVoucherDetailId) as SaleInvoiceTaxAmount on SaleInvoiceTaxAmount.sourceVoucherDetailId=SaleDeliveryDetailDTO.id                 left join\r\n                (select \r\n\t\t                            sum(SA_SaleDeliverySourceRelation.quantity) quantity,\r\n\t\t                            sum(SA_SaleDeliverySourceRelation.basequantity) basequantity,\r\n\t\t                            sum(Round((case BaseUnit.changetype1 \r\n               when  N\'24\' then\r\n                    (case ReportSubunitPrice.idunit when SA_SaleDeliverySourceRelation.idbaseunit then SA_SaleDeliverySourceRelation.basequantity else (CAST(SA_SaleDeliverySourceRelation.basequantity AS NUMERIC(20,7)))/ReportSubunitPrice.rateofexchange end)\r\n               when  N\'152\' then\r\n                    (case ReportSubunitPrice.idunit when SA_SaleDeliverySourceRelation.idbaseunit then SA_SaleDeliverySourceRelation.basequantity else SA_SaleDeliverySourceRelation.subquantity end)\r\n               end),2, 0)) subquantity,\r\n\t\t                            SA_SaleDeliverySourceRelation.sourceVoucherDetailId \r\n\t                            from SA_SaleDeliverySourceRelation,SA_SaleDelivery,SA_SaleDelivery_b \r\n                                left join V_AA_Inventory as Inventory on SA_SaleDelivery_b.idinventory=Inventory.id\r\n                          left join AA_Unit as BaseUnit on SA_SaleDelivery_b.idbaseunit=BaseUnit.id \r\n                          left join AA_InventoryUnitPrice as ReportSubunitPrice on ReportSubunitPrice.idunit=inventory.idUnitBySale  and inventory.id=ReportSubunitPrice.Idinventory\r\n                                where \r\n\t                            voucherId=SA_SaleDelivery.id and SA_SaleDelivery.isCounteractDelivery=1 and ((0=0 and SA_SaleDelivery.voucherState<> N\'181\') or (0=1)) \r\n                                and SA_SaleDeliverySourceRelation.idSaleDeliveryDetailDTO=SA_SaleDelivery_b.id\r\n                                and SA_SaleDeliverySourceRelation.idsourcevouchertype in (select id from SM_VoucherType where code in (N\'SYS0921\',N\'SA04\'))\r\n\t                            group by SA_SaleDeliverySourceRelation.sourceVoucherDetailId)\r\n               as CounteractDeliveryQuantity on CounteractDeliveryQuantity.sourceVoucherDetailId=SaleDeliveryDetailDTO.id\r\n             where  1=1  and SaleDelivery.Voucherdate>= N\'2018-09-26\' AND SaleDelivery.Voucherdate<= N\'2018-09-26 22:52:19\' and  SaleDelivery.VoucherState =  N\'??\'',
        islogerror: '1' } } }
